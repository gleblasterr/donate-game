<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DONATE GAME</title>

  <style>
    body {
      font-family: system-ui, Arial, sans-serif;
      max-width: 820px;
      margin: 32px auto;
      padding: 0 16px;
      background: #f7f7f7;
    }

    h1 { margin-bottom: 8px; }

    .card {
      background: #fff;
      border: 2px solid #000;
      border-radius: 14px;
      padding: 20px;
      margin: 16px 0;
      box-shadow: 6px 6px 0 #000;
      font-family: monospace;
    }

    label { display: block; margin: 10px 0 6px; }

    input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 2px solid #000;
      border-radius: 10px;
      font-family: monospace;
    }

    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .row > div { flex: 1; min-width: 220px; }

    .hint { font-size: 14px; opacity: 0.7; margin-top: 6px; }

    #paypal-button-container { margin-top: 16px; }

    footer { margin-top: 40px; font-size: 12px; opacity: 0.5; text-align: center; }
  </style>
</head>

<body>
  <h1>üéÆ DONATE GAME</h1>
  <p>–ü–æ–¥–¥–µ—Ä–∂–∏ –∏–≥—Ä—É –¥–æ–Ω–∞—Ç–æ–º</p>

  <div class="card">
    <h2>üí∞ –î–æ–Ω–∞—Ç</h2>

    <div class="row">
      <div>
        <label for="amount">–°—É–º–º–∞ (USD)</label>
        <input id="amount" type="number" min="1" step="1" value="5">
        <div class="hint">–ú–∏–Ω–∏–º—É–º 1 USD</div>
      </div>

      <div>
        <label for="name">–ò–º—è –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ</label>
        <input id="name" type="text" maxlength="24" placeholder="Gleb">
        <div class="hint">–ó–∞–ø–∏—à–µ–º –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã</div>
      </div>
    </div>

    <div id="paypal-button-container"></div>
    <div id="result" class="hint"></div>

    <hr style="margin:16px 0; border:0; border-top:2px solid #000; opacity:.15">

    <h2>üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</h2>
    <div id="leaderboard" class="hint">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –°—Ç–∞–Ω—å –ø–µ—Ä–≤—ã–º –¥–æ–Ω–∞—Ç–µ—Ä–æ–º üôÇ</div>
  </div>

  <footer>Donate Game ¬∑ Sandbox PayPal</footer>

  <!-- PAYPAL SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AaF6KfBHuIJGD6aPWP7M2SfuZGNaR-KqO2Bz9uNXrFckVG2Rs5N1KHDHexSIhHg19fqVh8I8AotWoF_m&currency=USD&intent=capture"></script>

  <script>
    const amountInput = document.getElementById('amount');
    const nameInput = document.getElementById('name');
    const resultEl = document.getElementById('result');
    const lbEl = document.getElementById('leaderboard');

    const STORAGE_KEY = "donate_game_leaderboard_v1";

    function getAmount() {
      const v = Number(amountInput.value);
      if (!Number.isFinite(v) || v < 1) return "1.00";
      return v.toFixed(2);
    }

    function safeName() {
      const s = (nameInput.value || "Anonymous").trim().slice(0, 24);
      return s || "Anonymous";
    }

    function escapeHtml(s) {
      return s.replace(/[&<>"']/g, c => ({
        "&":"&amp;",
        "<":"&lt;",
        ">":"&gt;",
        '"':"&quot;",
        "'":"&#039;"
      }[c]));
    }

    function loadLB() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      } catch {
        return [];
      }
    }

    function saveLB(items) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
    }

    function renderLB() {
      const items = loadLB();
      if (!items.length) {
        lbEl.textContent = "–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –°—Ç–∞–Ω—å –ø–µ—Ä–≤—ã–º –¥–æ–Ω–∞—Ç–µ—Ä–æ–º üôÇ";
        return;
      }

      const top = items
        .slice()
        .sort((a, b) => (b.amount - a.amount) || (b.ts - a.ts))
        .slice(0, 10);

      lbEl.innerHTML =
        '<ol style="margin:8px 0 0; padding-left:20px;">' +
        top.map(x => `<li><b>${escapeHtml(x.name)}</b> ‚Äî $${Number(x.amount).toFixed(2)}</li>`).join("") +
        '</ol><div class="hint">–•—Ä–∞–Ω–∏—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ (localStorage).</div>';
    }

    function addToLB(name, amount) {
      const items = loadLB();
      items.push({ name, amount, ts: Date.now() });
      saveLB(items);
      renderLB();
    }

    renderLB();

    // –ù–∞ –≤—Å—è–∫–∏–π: –µ—Å–ª–∏ PayPal SDK –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è ‚Äî –ø–æ–∫–∞–∂–µ–º –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (typeof paypal === "undefined") {
      resultEl.textContent = "‚ùå PayPal SDK –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è. –ü—Ä–æ–≤–µ—Ä—å Client ID –∏ –∫–æ–Ω—Å–æ–ª—å.";
    } else {
      paypal.Buttons({
        style: { layout: 'vertical', label: 'donate' },

        createOrder: (data, actions) => {
          return actions.order.create({
            purchase_units: [{
              description: "Donate Game: " + safeName(),
              amount: { currency_code: "USD", value: getAmount() }
            }]
          });
        },

        onApprove: async (data, actions) => {
          const details = await actions.order.capture();
          const payer = details && details.payer && details.payer.name && details.payer.name.given_name
            ? details.payer.name.given_name
            : "–¥—Ä—É–≥";

          resultEl.textContent = `‚úÖ –°–ø–∞—Å–∏–±–æ, ${payer}! –î–æ–Ω–∞—Ç –ø—Ä–∏–Ω—è—Ç. Order ID: ${data.orderID}`;

          addToLB(safeName(), Number(getAmount()));
          console.log("PayPal capture details:", details);
        },

        onCancel: () => { resultEl.textContent = "‚õî –ü–ª–∞—Ç—ë–∂ –æ—Ç–º–µ–Ω—ë–Ω."; },

        onError: (err) => {
          console.error(err);
          resultEl.textContent = "‚ùå –û—à–∏–±–∫–∞ PayPal. –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å (F12) –∏ –ø—Ä–∏—à–ª–∏ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏.";
        }
      }).render('#paypal-button-container');
    }
  </script>
</body>
</html>
